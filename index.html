<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Time Use & Spatial Preference Survey</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        h1 {
            font-size: 2rem;
            font-weight: 600;
            color: #222;
            margin-bottom: 8px;
        }
        
        .subtitle {
            font-size: 0.95rem;
            color: #666;
        }
        
        .prolific-section {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 20px;
            margin-bottom: 20px;
            transition: border-color 0.2s ease, border-width 0.2s ease;
        }
        
        .prolific-section:focus-within {
            border: 2px solid #0066cc;
        }
        
        .prolific-section label {
            display: block;
            font-size: 1rem;
            font-weight: 600;
            color: #222;
            margin-bottom: 8px;
        }
        
        .prolific-section input {
            width: 100%;
            max-width: 400px;
        }
        
        .demographics-section {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 20px;
            margin-bottom: 20px;
            transition: border-color 0.2s ease, border-width 0.2s ease;
        }
        
        .demographics-section:focus-within {
            border: 2px solid #0066cc;
        }
        
        .demographics-section h3 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #222;
            margin-bottom: 16px;
        }
        
        .info-box {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 16px;
            margin-bottom: 30px;
            border-left: 4px solid #0066cc;
        }
        
        .completion-page {
            display: none;
            text-align: center;
            padding: 60px 20px;
        }
        
        .completion-page.active {
            display: block;
        }
        
        .completion-box {
            background: #fff;
            border: 2px solid #28a745;
            border-radius: 8px;
            padding: 40px;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .completion-box h2 {
            color: #28a745;
            font-size: 1.8rem;
            margin-bottom: 20px;
        }
        
        .completion-box p {
            font-size: 1.1rem;
            color: #555;
            margin-bottom: 24px;
            line-height: 1.8;
        }
        
        .completion-code {
            background: #f0f0f0;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 12px 20px;
            font-family: 'Courier New', monospace;
            font-size: 1.3rem;
            font-weight: 600;
            color: #222;
            margin: 20px 0;
        }
        
        .prolific-link {
            display: inline-block;
            background: #0066cc;
            color: white;
            padding: 14px 32px;
            border-radius: 4px;
            text-decoration: none;
            font-weight: 600;
            margin-top: 20px;
        }
        
        .prolific-link:hover {
            background: #0052a3;
        }
        
        .survey-container {
            display: block;
        }
        
        .survey-container.hidden {
            display: none;
        }
        
        .info-box p {
            color: #555;
            font-size: 0.95rem;
        }
        
        .entries-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .entry-card {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 24px;
            transition: border-color 0.2s ease, border-width 0.2s ease;
        }
        
        .entry-card:focus-within {
            border: 2px solid #0066cc;
        }
        
        .entry-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid #eee;
        }
        
        .entry-number {
            font-size: 1.2rem;
            font-weight: 600;
            color: #222;
        }
        
        .delete-btn {
            background: #fff;
            border: 1px solid #dc3545;
            color: #dc3545;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .delete-btn:hover {
            background: #dc3545;
            color: white;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .form-group.full-width {
            grid-column: 1 / -1;
        }
        
        label {
            font-size: 0.9rem;
            font-weight: 500;
            color: #555;
        }
        
        input[type="time"],
        select,
        input[type="text"],
        textarea {
            background: #fff;
            border: 1px solid #ccc;
            color: #333;
            padding: 8px 12px;
            border-radius: 4px;
            font-family: inherit;
            font-size: 0.95rem;
        }
        
        input[type="time"]:focus,
        select:focus,
        input[type="text"]:focus,
        textarea:focus {
            outline: none;
            border-color: #0066cc;
        }
        
        select {
            cursor: pointer;
        }
        
        optgroup {
            font-weight: 600;
            font-style: normal;
            color: #0066cc;
        }
        
        textarea {
            resize: vertical;
            min-height: 80px;
        }
        
        .spatial-section {
            background: #f9f9f9;
            border: 1px solid #e5e5e5;
            border-radius: 4px;
            padding: 16px;
            margin-top: 16px;
        }
        
        .spatial-section h3 {
            font-size: 1rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 12px;
        }
        
        .add-entry-btn,
        .submit-btn {
            background: #0066cc;
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            margin-top: 16px;
            width: 100%;
        }
        
        .add-entry-btn:hover,
        .submit-btn:hover {
            background: #0052a3;
        }
        
        .submit-btn {
            background: #28a745;
            margin-top: 30px;
        }
        
        .submit-btn:hover {
            background: #218838;
        }
        
        .time-duration {
            font-size: 0.85rem;
            color: #666;
            margin-top: 4px;
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 1.5rem;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .entry-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="survey-container" id="survey-container">
            <header>
                <h1>Daily Activity & Residential Preference Survey</h1>
                <p class="subtitle">Document your weekday activities and describe your ideal residential room structure for each activity</p>
            </header>
            
            <div class="prolific-section">
                <label for="prolific-id">Prolific ID *</label>
                <input type="text" id="prolific-id" placeholder="Enter your Prolific ID" required>
            </div>
            
            <div class="demographics-section">
                <h3>Demographic Information</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Age *</label>
                        <input type="text" id="age" placeholder="Enter your age" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Gender *</label>
                        <select id="gender" required>
                            <option value="">Select...</option>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                            <option value="prefer_not">Prefer not to answer</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Household Type *</label>
                        <select id="household-type" required>
                            <option value="">Select...</option>
                            <option value="one_person">One person</option>
                            <option value="family_no_children">Family with no children</option>
                            <option value="family_dependent_children">Family with dependent children</option>
                            <option value="family_nondependent_children">Family with non-dependent children only</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Working Status *</label>
                        <select id="working-status" required>
                            <option value="">Select...</option>
                            <option value="full_time">Full time worker (more than 35h a week)</option>
                            <option value="part_time">Part time worker (less than 35h a week)</option>
                            <option value="freelancer">Freelancer</option>
                            <option value="student">University student</option>
                            <option value="non_working">Non-working adult</option>
                            <option value="retired">Retired</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="info-box">
                <p>ðŸ“‹ Please record all activities from <strong>4:00 AM to 4:00 AM the following day</strong> during a typical weekday. For each entry, describe your ideal residential room preferences for performing that activity.</p>
            </div>
            
            <div id="entries-container" class="entries-container">
                <!-- Entries will be added here -->
            </div>
            
            <button class="add-entry-btn" onclick="addEntry()">+ Add Activity Entry</button>
            <button class="submit-btn" onclick="submitSurvey()">Submit Survey</button>
        </div>
        
        <div class="completion-page" id="completion-page">
            <div class="completion-box">
                <h2>âœ“ Survey Complete!</h2>
                <p>Your response has been recorded.</p>
                <p>Please return to Prolific through this link or with the code below to complete your submission.</p>
                <div class="completion-code">COC9BJ2P</div>
                <a href="https://app.prolific.com/submissions/complete?cc=COC9BJ2P" class="prolific-link" target="_blank">Return to Prolific</a>
            </div>
        </div>
    </div>

    <script>
        const activitiesGrouped = [
            {
                label: "Sleeping, personal care, medication",
                options: [
                    { value: "1", text: "1. Sleeping" },
                    { value: "2", text: "2. Washing, dressing, using the bathroom and self-grooming" },
                    { value: "3", text: "3. Medication, other health related care" }
                ]
            },
            {
                label: "Eating, drinking, cooking",
                options: [
                    { value: "4", text: "4. Making food and drinks, cooking" },
                    { value: "5", text: "5. Eating a meal, eating out, take-away" },
                    { value: "6", text: "6. Snacking" },
                    { value: "7", text: "7. Drinking (e.g. tea, coffee, alcohol)" }
                ]
            },
            {
                label: "Work and other activities for pay",
                options: [
                    { value: "8", text: "8. Working" },
                    { value: "9", text: "9. Working from home" },
                    { value: "10", text: "10. Working from a cafÃ© or other workspace" },
                    { value: "11", text: "11. Providing childcare, cleaning, or doing odd jobs for pay" },
                    { value: "12", text: "12. Leasing or renting things you own" },
                    { value: "13", text: "13. Using your private vehicle to earn money" },
                    { value: "14", text: "14. Showing your own house, flat, or building to potential buyers" },
                    { value: "15", text: "15. Selling your things, apart from your home" }
                ]
            },
            {
                label: "Travel and getting around",
                options: [
                    { value: "16", text: "16. Travelling to or from paid work" },
                    { value: "17", text: "17. Travelling to or from unpaid work" },
                    { value: "18", text: "18. Travelling to or from a shop" },
                    { value: "19", text: "19. Travelling to or from socialising with others" },
                    { value: "20", text: "20. Travelling to escort children to or from childcare or school" },
                    { value: "21", text: "21. Travelling to or from another place" },
                    { value: "22", text: "22. Packing or unpacking, preparing for journey" }
                ]
            },
            {
                label: "Housework, pets, DIY and gardening",
                options: [
                    { value: "23", text: "23. Cleaning, hoovering, tidying house, sorting the bins" },
                    { value: "24", text: "24. Using dishwasher or washing up" },
                    { value: "25", text: "25. Arranging, sorting or unpacking household items" },
                    { value: "26", text: "26. Ironing, washing, other laundry tasks or mending clothes" },
                    { value: "27", text: "27. Repairing, maintaining or making household goods, or vehicles" },
                    { value: "28", text: "28. Lighting fire or cleaning fireplace, log burner or wood burning stove" },
                    { value: "29", text: "29. Feeding, caring for or playing with animals (pets)" },
                    { value: "30", text: "30. Walking the dog" },
                    { value: "31", text: "31. DIY" },
                    { value: "32", text: "32. Gardening" }
                ]
            },
            {
                label: "Volunteering",
                options: [
                    { value: "33", text: "33. Volunteering as part of a group, organisation, charity, or sports club" }
                ]
            },
            {
                label: "Caring for and looking after children and adults",
                options: [
                    { value: "34", text: "34. Feeding, washing, dressing or preparing meals for children" },
                    { value: "35", text: "35. Reading with children, helping with homework" },
                    { value: "36", text: "36. Playing with children" },
                    { value: "37", text: "37. Attending or watching a child's event or activity" },
                    { value: "38", text: "38. Supporting, comforting or cuddling children" },
                    { value: "39", text: "39. Other childcare not elsewhere listed" },
                    { value: "40", text: "40. Helping, caring for and looking after adults (aged 18+)" }
                ]
            },
            {
                label: "Shopping, household administration tasks and appointments",
                options: [
                    { value: "41", text: "41. Buying something, shopping" },
                    { value: "42", text: "42. Browsing things to buy later, or window shopping" },
                    { value: "43", text: "43. Household administration tasks" },
                    { value: "44", text: "44. Attending appointments or errands" },
                    { value: "45", text: "45. Queueing or waiting" },
                    { value: "46", text: "46. Completing a document" }
                ]
            },
            {
                label: "Free time, entertainment and socialising",
                options: [
                    { value: "47", text: "47. Watching TV and DVDs" },
                    { value: "48", text: "48. Checking phone or tablet" },
                    { value: "49", text: "49. Listening to music, podcasts, audiobooks, talk shows, radio or news" },
                    { value: "50", text: "50. Playing games or computer gaming" },
                    { value: "51", text: "51. Checking or using social media" },
                    { value: "52", text: "52. Browsing internet" },
                    { value: "53", text: "53. Checking email" },
                    { value: "54", text: "54. Reading books, magazines or newspapers" },
                    { value: "55", text: "55. Socialising, spending time with friends, family, neighbours and colleagues" },
                    { value: "56", text: "56. Having a conversation" },
                    { value: "57", text: "57. Writing, texting or emailing" },
                    { value: "58", text: "58. Visits to cinema, theatre, concerts, sporting events, museums, galleries, library etc." },
                    { value: "59", text: "59. Attending a meeting or an event" },
                    { value: "60", text: "60. Hobbies and other leisure activities" },
                    { value: "61", text: "61. Resting (doing nothing) or in bed not asleep" }
                ]
            },
            {
                label: "Exercise, health and being active",
                options: [
                    { value: "62", text: "62. Gym, fitness, or exercise classes" },
                    { value: "63", text: "63. Running or jogging" },
                    { value: "64", text: "64. Cycling" },
                    { value: "65", text: "65. Playing team sports" },
                    { value: "66", text: "66. Playing other sports and exercising" },
                    { value: "67", text: "67. Going for a walk as exercise" },
                    { value: "68", text: "68. Meditating, having a massage, spa or wellbeing treatments" },
                    { value: "69", text: "69. Other health or well-being activity" }
                ]
            },
            {
                label: "Education and study",
                options: [
                    { value: "70", text: "70. Attending formal education or taking a course" },
                    { value: "71", text: "71. Learning or teaching yourself a skill not involving taught classes" },
                    { value: "72", text: "72. Studying, revising or doing homework" }
                ]
            },
            {
                label: "Other computer use",
                options: [
                    { value: "73", text: "73. Other computer or laptop use" }
                ]
            },
            {
                label: "Other or personal",
                options: [
                    { value: "74", text: "74. Other activities not listed" },
                    { value: "75", text: "75. Praying" },
                    { value: "76", text: "76. Smoking or vaping" },
                    { value: "77", text: "77. Completing the time-use diary" }
                ]
            }
        ];

        const whoForOptions = [
            { value: "", text: "Select..." },
            { value: "myself", text: "Myself" },
            { value: "child", text: "Child/Children" },
            { value: "adult", text: "Another Adult" },
            { value: "family", text: "Family" }
        ];

        const roomTypes = [
            { value: "", text: "Select room type..." },
            { value: "living_room", text: "Living Room" },
            { value: "kitchen", text: "Kitchen" },
            { value: "dining_room", text: "Dining Room" },
            { value: "bedroom", text: "Bedroom" },
            { value: "bathroom", text: "Bathroom" },
            { value: "storeroom", text: "Storeroom" },
            { value: "porch_terrace", text: "Porch/Terrace" },
            { value: "other", text: "Other" }
        ];

        const sizeOptions = [
            { value: "", text: "Select size..." },
            { value: "1-1.9", text: "1~1.9mÂ²" },
            { value: "2-2.9", text: "2~2.9mÂ²" },
            { value: "3-3.9", text: "3~3.9mÂ²" },
            { value: "4-4.9", text: "4~4.9mÂ²" },
            { value: "5+", text: "5mÂ²+" }
        ];

        const orientations = [
            { value: "", text: "Select orientation..." },
            { value: "north", text: "North" },
            { value: "south", text: "South" },
            { value: "east", text: "East" },
            { value: "west", text: "West" }
        ];

        let entryCount = 0;

        function createActivityOptions() {
            let html = '<option value="">Select an activity...</option>';
            activitiesGrouped.forEach(group => {
                html += `<optgroup label="${group.label}">`;
                group.options.forEach(opt => {
                    html += `<option value="${opt.value}">${opt.text}</option>`;
                });
                html += '</optgroup>';
            });
            return html;
        }

        function createSimpleOptions(optionsArray) {
            return optionsArray.map(opt => 
                `<option value="${opt.value}">${opt.text}</option>`
            ).join('');
        }

        function addEntry(startTime = '') {
            entryCount++;
            const isFirst = entryCount === 1;
            const defaultStartTime = isFirst ? '04:00' : startTime;
            
            const entryHTML = `
                <div class="entry-card" id="entry-${entryCount}">
                    <div class="entry-header">
                        <span class="entry-number">Entry #${entryCount}</span>
                        ${!isFirst ? `<button class="delete-btn" onclick="deleteEntry(${entryCount})">Delete</button>` : ''}
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Start Time *</label>
                            <input type="time" id="start-${entryCount}" value="${defaultStartTime}" ${isFirst ? 'readonly' : ''} onchange="calculateDuration(${entryCount})">
                        </div>
                        
                        <div class="form-group">
                            <label>End Time *</label>
                            <input type="time" id="end-${entryCount}" onchange="calculateDuration(${entryCount})">
                            <div class="time-duration" id="duration-${entryCount}"></div>
                        </div>
                        
                        <div class="form-group">
                            <label>Main Activity *</label>
                            <select id="main-activity-${entryCount}">
                                ${createActivityOptions()}
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Secondary Activity</label>
                            <select id="secondary-activity-${entryCount}">
                                ${createActivityOptions()}
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Who did you do this for? *</label>
                            <select id="who-for-${entryCount}">
                                ${createSimpleOptions(whoForOptions)}
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Where *</label>
                            <select id="where-${entryCount}" onchange="toggleWhereOther(${entryCount})">
                                ${createSimpleOptions(roomTypes)}
                            </select>
                        </div>
                        
                        <div class="form-group" id="where-other-group-${entryCount}" style="display: none;">
                            <label>Specify location</label>
                            <input type="text" id="where-other-${entryCount}" placeholder="Please specify">
                        </div>
                        
                        <div class="form-group">
                            <label>Tools Used</label>
                            <input type="text" id="device-${entryCount}" placeholder="e.g., Phone, Laptop, None, etc.">
                        </div>
                    </div>
                    
                    <div class="spatial-section">
                        <h3>Ideal Room Description for This Activity *</h3>
                        <p style="font-size: 0.85rem; color: #666; margin-bottom: 16px;">If you have no room preference for any item, you can leave it blank.</p>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Room Type</label>
                                <select id="room-type-${entryCount}" onchange="toggleRoomTypeOther(${entryCount})">
                                    ${createSimpleOptions(roomTypes)}
                                </select>
                            </div>
                            
                            <div class="form-group" id="room-type-other-group-${entryCount}" style="display: none;">
                                <label>Specify room type</label>
                                <input type="text" id="room-type-other-${entryCount}" placeholder="Please specify">
                            </div>
                            
                            <div class="form-group">
                                <label>Size</label>
                                <select id="room-size-${entryCount}">
                                    ${createSimpleOptions(sizeOptions)}
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label>Adjacent to</label>
                                <select id="adjacency-${entryCount}" onchange="toggleAdjacencyOther(${entryCount})">
                                    ${createSimpleOptions(roomTypes)}
                                </select>
                            </div>
                            
                            <div class="form-group" id="adjacency-other-group-${entryCount}" style="display: none;">
                                <label>Specify adjacent room</label>
                                <input type="text" id="adjacency-other-${entryCount}" placeholder="Please specify">
                            </div>
                            
                            <div class="form-group">
                                <label>Connected to</label>
                                <select id="connectivity-${entryCount}" onchange="toggleConnectivityOther(${entryCount})">
                                    ${createSimpleOptions(roomTypes)}
                                </select>
                            </div>
                            
                            <div class="form-group" id="connectivity-other-group-${entryCount}" style="display: none;">
                                <label>Specify connected room</label>
                                <input type="text" id="connectivity-other-${entryCount}" placeholder="Please specify">
                            </div>
                            
                            <div class="form-group">
                                <label>Orientation</label>
                                <select id="orientation-${entryCount}">
                                    ${createSimpleOptions(orientations)}
                                </select>
                            </div>
                            
                            <div class="form-group full-width">
                                <label>Additional Notes</label>
                                <textarea id="notes-${entryCount}" placeholder="Any other spatial preferences or requirements..."></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('entries-container').insertAdjacentHTML('beforeend', entryHTML);
        }

        function calculateDuration(entryId) {
            const startInput = document.getElementById(`start-${entryId}`);
            const endInput = document.getElementById(`end-${entryId}`);
            const durationDiv = document.getElementById(`duration-${entryId}`);
            
            if (startInput.value && endInput.value) {
                let start = parseTime(startInput.value);
                let end = parseTime(endInput.value);
                
                // Handle overnight activities
                if (end < start) {
                    end += 24 * 60;
                }
                
                const diff = end - start;
                const hours = Math.floor(diff / 60);
                const minutes = diff % 60;
                
                durationDiv.textContent = `Duration: ${hours}h ${minutes}m`;
            }
        }

        function parseTime(timeString) {
            const [hours, minutes] = timeString.split(':').map(Number);
            return hours * 60 + minutes;
        }
        
        function toggleWhereOther(entryId) {
            const whereSelect = document.getElementById(`where-${entryId}`);
            const otherGroup = document.getElementById(`where-other-group-${entryId}`);
            
            if (whereSelect.value === 'other') {
                otherGroup.style.display = 'flex';
            } else {
                otherGroup.style.display = 'none';
            }
        }
        
        function toggleRoomTypeOther(entryId) {
            const roomTypeSelect = document.getElementById(`room-type-${entryId}`);
            const otherGroup = document.getElementById(`room-type-other-group-${entryId}`);
            
            if (roomTypeSelect.value === 'other') {
                otherGroup.style.display = 'flex';
            } else {
                otherGroup.style.display = 'none';
            }
        }
        
        function toggleAdjacencyOther(entryId) {
            const adjacencySelect = document.getElementById(`adjacency-${entryId}`);
            const otherGroup = document.getElementById(`adjacency-other-group-${entryId}`);
            
            if (adjacencySelect.value === 'other') {
                otherGroup.style.display = 'flex';
            } else {
                otherGroup.style.display = 'none';
            }
        }
        
        function toggleConnectivityOther(entryId) {
            const connectivitySelect = document.getElementById(`connectivity-${entryId}`);
            const otherGroup = document.getElementById(`connectivity-other-group-${entryId}`);
            
            if (connectivitySelect.value === 'other') {
                otherGroup.style.display = 'flex';
            } else {
                otherGroup.style.display = 'none';
            }
        }

        function deleteEntry(entryId) {
            const entry = document.getElementById(`entry-${entryId}`);
            if (entry && confirm('Are you sure you want to delete this entry?')) {
                entry.remove();
            }
        }

        function submitSurvey() {
            // Check Prolific ID
            const prolificId = document.getElementById('prolific-id').value.trim();
            if (!prolificId) {
                alert('Please enter your Prolific ID before submitting.');
                document.getElementById('prolific-id').focus();
                return;
            }
            
            // Check demographics
            const age = document.getElementById('age').value.trim();
            const gender = document.getElementById('gender').value;
            const familyStructure = document.getElementById('family-structure').value;
            const workingStatus = document.getElementById('working-status').value;
            
            if (!age || !gender || !familyStructure || !workingStatus) {
                alert('Please fill in all demographic information.');
                return;
            }
            
            const entries = [];
            const cards = document.querySelectorAll('.entry-card');
            
            let isValid = true;
            
            cards.forEach((card, index) => {
                const id = card.id.split('-')[1];
                
                const whereValue = document.getElementById(`where-${id}`).value;
                const whereOther = document.getElementById(`where-other-${id}`).value;
                const whereLocation = whereValue === 'other' ? whereOther : whereValue;
                
                const roomTypeValue = document.getElementById(`room-type-${id}`).value;
                const roomTypeOther = document.getElementById(`room-type-other-${id}`).value;
                const roomType = roomTypeValue === 'other' ? roomTypeOther : roomTypeValue;
                
                const adjacencyValue = document.getElementById(`adjacency-${id}`).value;
                const adjacencyOther = document.getElementById(`adjacency-other-${id}`).value;
                const adjacency = adjacencyValue === 'other' ? adjacencyOther : adjacencyValue;
                
                const connectivityValue = document.getElementById(`connectivity-${id}`).value;
                const connectivityOther = document.getElementById(`connectivity-other-${id}`).value;
                const connectivity = connectivityValue === 'other' ? connectivityOther : connectivityValue;
                
                const entry = {
                    entryNumber: index + 1,
                    startTime: document.getElementById(`start-${id}`).value,
                    endTime: document.getElementById(`end-${id}`).value,
                    mainActivity: document.getElementById(`main-activity-${id}`).value,
                    secondaryActivity: document.getElementById(`secondary-activity-${id}`).value,
                    whoFor: document.getElementById(`who-for-${id}`).value,
                    where: whereLocation,
                    device: document.getElementById(`device-${id}`).value,
                    spatialPreferences: {
                        roomType: roomType,
                        size: document.getElementById(`room-size-${id}`).value,
                        adjacency: adjacency,
                        connectivity: connectivity,
                        orientation: document.getElementById(`orientation-${id}`).value,
                        notes: document.getElementById(`notes-${id}`).value
                    }
                };
                
                // Check all required fields
                if (!entry.startTime || !entry.endTime || !entry.mainActivity || 
                    !entry.whoFor || !entry.where) {
                    isValid = false;
                }
                
                if (whereValue === 'other' && !whereOther.trim()) {
                    isValid = false;
                }
                
                entries.push(entry);
            });
            
            if (!isValid) {
                alert('Please fill in all required fields (marked with *) for all entries.');
                return;
            }
            
            // Confirmation dialog
            if (!confirm('Are you sure you want to submit your completed survey?')) {
                return;
            }
            
            // Prepare data with Prolific ID and demographics
            const surveyData = {
                prolificId: prolificId,
                demographics: {
                    age: age,
                    gender: gender,
                    familyStructure: familyStructure,
                    workingStatus: workingStatus
                },
                submittedAt: new Date().toISOString(),
                entries: entries
            };
            
            console.log('Survey Data:', surveyData);
            
            // Convert to JSON and download
            const dataStr = JSON.stringify(surveyData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `time-use-survey-${prolificId}-${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            // Hide survey and show completion page
            document.getElementById('survey-container').classList.add('hidden');
            document.getElementById('completion-page').classList.add('active');
        }

        // Initialize with first entry
        addEntry();
    </script>
</body>
</html>
